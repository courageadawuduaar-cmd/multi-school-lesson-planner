{% extends "base.html" %}
{% block title %}Teacher Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">

        <!-- ================= SIDEBAR ================= -->
        <div class="col-md-3 col-lg-2 bg-dark text-white min-vh-100 p-4">
            <h4 class="mb-4">Teacher</h4>

            <ul class="nav flex-column gap-2">
                <li class="nav-item">
                    <a class="nav-link text-white" href="{{ url_for('teacher_dashboard') }}">
                        üè† Dashboard
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link text-white" href="{{ url_for('create_lesson') }}">
                        ‚ûï Create Lesson
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link text-white" href="{{ url_for('view_lessons') }}">
                        üìö My Lessons
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link text-white" href="#schemes">
                        üìÑ Approved Schemes
                    </a>
                </li>
            </ul>
        </div>

        <!-- ================= MAIN CONTENT ================= -->
        <div class="col-md-9 col-lg-10 p-4">

            <!-- HEADER -->
            <div class="p-4 mb-4 rounded-4 shadow-sm text-white"
                 style="background: linear-gradient(135deg, #198754, #20c997);">
                <h2 class="fw-bold mb-1">
                    Welcome, {{ current_user.name or current_user.email }}
                </h2>
                <p class="mb-0">
                    Manage your lesson plans, submissions, and approved schemes.
                </p>
            </div>

            <!-- FLASH MESSAGES -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- ================= STATS ================= -->
            <div class="row g-4 mb-5">

                <div class="col-md-4">
                    <div class="card shadow-sm border-0 bg-primary text-white">
                        <div class="card-body text-center">
                            <h6>Total Lessons</h6>
                            <h2>{{ total_lessons }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card shadow-sm border-0 bg-success text-white">
                        <div class="card-body text-center">
                            <h6>Approved Lessons</h6>
                            <h2>{{ approved_lessons }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card shadow-sm border-0 bg-warning text-dark">
                        <div class="card-body text-center">
                            <h6>Pending Lessons</h6>
                            <h2>{{ pending_lessons }}</h2>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ================= QUICK ACTIONS ================= -->
            <div class="row g-4 mb-5">

                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="fs-1 text-primary mb-2">‚ûï</div>
                            <h5 class="fw-bold">Create Lesson</h5>
                            <p class="text-muted small">
                                Prepare and submit a new lesson plan.
                            </p>
                            <a href="{{ url_for('create_lesson') }}"
                               class="btn btn-primary btn-sm px-4">
                                Create
                            </a>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="fs-1 text-success mb-2">üìö</div>
                            <h5 class="fw-bold">My Lessons</h5>
                            <p class="text-muted small">
                                Track submissions and approvals.
                            </p>
                            <a href="{{ url_for('view_lessons') }}"
                               class="btn btn-success btn-sm px-4">
                                View
                            </a>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="fs-1 text-warning mb-2">üìÑ</div>
                            <h5 class="fw-bold">Approved Schemes</h5>
                            <p class="text-muted small">
                                View schemes assigned to you.
                            </p>
                            <a href="#schemes"
                               class="btn btn-warning btn-sm px-4">
                                View
                            </a>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ================= SCHEMES TABLE ================= -->
            <div id="schemes" class="card shadow-sm border-0">
                <div class="card-header bg-light fw-bold">
                    Approved Yearly Schemes
                </div>

                <div class="card-body p-0">
                    {% if approved_schemes %}
                        <table class="table table-hover mb-0">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Class</th>
                                    <th>Subject</th>
                                    <th>Academic Year</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for scheme in approved_schemes %}
                                <tr>
                                    <td>{{ scheme.class_name }}</td>
                                    <td>{{ scheme.subject }}</td>
                                    <td>{{ scheme.academic_year }}</td>
                                    <td>
                                        <span class="badge bg-success">
                                            Approved
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <div class="p-4 text-center text-muted">
                            No approved schemes assigned yet.
                        </div>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}